# README: Documentation for A3

## RED-GREEN-REFACTOR process
The test-driven development process was applied to the Model. Commits have been categorised based on the set of
functionality they related to and are further divided into iterations to reflect ongoing change in the software
design process and how this affects testing and code implementation.

**Representation of food items as data objects and food search functionality**\
<ins>Iteration 1 - Basic functionality </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/9e2c94a29679c4939cbb98b4caf99ba4d9f08031 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/ac34b0a819fbef5d34f2ede8d1281df9c8fc4f72 \
Refactor: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/8028544ebcf607ff6acb8eaa6a579ea68f3d9095

<ins>Iteration 2 - Expanded existing functionality to better meet specifications </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/bca5d24c26a942af3a5d191b1327e3c40511c3f2 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/afaeb23eca13245e48b35917a60750741823e714

<ins>Iteration 3 - Redesign by incorporating interfaces for better modularity and reusability  </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/0ea2a44351ea2fca1ad55ca256d90c06a5070c95 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/46b53201c7001decb8225aa065e556b6e863a127 \
Refactor: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/c5736f045abc226a9f52f801a5299328fa5e4a60

**Representation of nutrition of food items as data objects and nutrition search functionality** \
<ins>Iteration 1 - Basic functionality </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/a18f5f1aa05688b403d3d385a42294df6f05ad68 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/adfd9b774a8ab5db5954f7d74f38021e6b4d0793

<ins>Iteration 2 - Expanded existing functionality to better meet specifications </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/b4a6894222a275a7c73b5cd5e58f327a8fd862e2 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/dcb3d8d28cb110885f574d9ce6e44de7bb3f173b

<ins>Iteration 3 - Redesign by incorporating interfaces for better modularity and reusability  </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/ecf0c9e106fa111e80c8edef052504dde6495ee1 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/ffd2ff5f4354f057992b35d667e04cda79f99a62 \
Refactor: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/2cfb40130f28b544bd36b7cb1ccf52aa8f8b90f2

**Nutrition report generation and upload functionality**\
<ins>Iteration 1 - Basic functionality </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/358cfd39b6fab83e0720264a8ab1e8f63fd46670 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/43f2c5aab98fbea75301611b92e52a798b07de92 \
Refactor: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/941b428d46b659e4e5faad1bcf67ecbd7b7efd9e

<ins>Iteration 2 - Necessary adjustments based on changes in implementation of the food and nutrition search
functionality </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/7d3decc5358edb10d3bf2d7f79cac51a7254af64 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/7afcdf4b0c0e3060a97664aa685450b771538499

<ins>Iteration 3 - Redesign by incorporating interfaces for better modularity and reusability  </ins> \
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/3d2ec9c23004598fa4f8d9b255e6c1f958828ada \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/0f88a8a5135170bf482d20ec33dde66041c9361d \
Refactor: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/2cfb40130f28b544bd36b7cb1ccf52aa8f8b90f2

**Database access and command queries for database communication through the model facade**\
<ins>Iteration 1 - Basic functionality </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/5f6a68eb2840c57ec813881f49d2fe88dff1eccd \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/9ccd45fd91d479c8ccc9ef9dad5c129072793df5

<ins>Iteration 2 - Necessary adjustments based on redesign of model classes </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/4f6c472d04eb44f8e909ef1650674ce4810e0037 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/6b2abd18e7075b855e3d2b43383935ff167f9b87

<ins>Iteration 3 - Further functionality </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/5475182a7dfd0cf6c5a1e5a9008957718053981c \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/debb0f43084a0f9b2a71d31a39e483984abe2437

<ins>Iteration 4 - Command queries to properly communciated with the database </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/b6290fd255629ac53b5bef07cd0269f272c3ce97 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/e94bd8e039e1545e22648110088acc379255dd3c

<ins>Iteration 5 - Adjustments made based on splitting the nutrition search and upload functionality </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/d914d45ffa4b254bcf197e78a81d51576f2a55d4 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/4970ca330fd1027bb4ced3bee2c5ee6b5ff34651

**Command queries for food and nutrition search functionality**\
<ins>Iteration 1 - Basic functionality </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/1ca2ebc220cf944ba7d035e559cfae1f38fa5619 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/b8d6d8940930649c12f26a86ec4baeeb1523372c

<ins>Iteration 2 - Necessary adjustments based on changed implementation of model classes </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/4f9744eaa7ebb70b9fffdc0a6f6fbaa8347f01b9 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/90f875d4e9e2e4003a490f0c204ef54dd59223a8 \
Refactor: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/4e212d591e56b41856157d26615fd063e982587f \
Refactor: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/4e212d591e56b41856157d26615fd063e982587f

<ins>Iteration 3 - Splitting the nutrition search and report upload functionality in light of spec clarification </ins>\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/7a00dbc37b0ca112eb37f5dcb7ae950fcf269314 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/5f1a8b4465967a4b98c4cb3a65aaa7e2a5ab0e19

**Functionality for setting and getting max calorie count and preparing alert popup based on calorie quantity of 
food item (exam extension)**\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/16b2f80853465dda3b82587dcc31b334388e0044 \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/940900c1ec84ea85781c93c3ef549a438b776822 \
Refactor: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/592f844872767e317f6e36a544b7a8664c1e5acc

**Functionality for having an alternate food nutrition report based on food item exceeding max calories (exam 
extension)**\
Red: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/47a0688ed1ad075067432cd8e51fd26cf53d25ab \
Green: https://github.sydney.edu.au/dhua9758/SCD2_2021_EXAM/commit/dcbf61ee32e466b17a2db0f257c15b5244c6b761


## Configuration files for API details
The assigned APIs for this codebase were the Edamam and Imgur API. The credentials for these may be configured in
the text file called 'ApiConfig.txt' found in the app directory where the src code and build.gradle file reside. If
for whatever reason this fails, the application has a built-in redundancy measure where it will alternatively read
from another 'ApiConfig.txt' file found in the resources folder under the 'main' directory. The format for entering
the details is as follows:

```Edamam application ID```\
```Edamam application key```\
```Imgur client ID```\
```Imgur access token```

Therefore, it might look something like (note these are random strings and these must be separated by new lines):

```5c8faabb7```\
```8f2e32cbb28dfcb8ed8b9411d42426eb```\
```6760e26d2cc4170```\
```12f0cbbd27ed2643623046f98e19be86b929ff0b```

If the provided authentications details are incorrect or not valid, the program should have defensive checks that will
notify the user about this.

## Quirks to running the application and clarification on undefined behaviour

**General layout of application and quirks of interaction**
- **Search bar:** The user can search for food items by inputting data into the search bar at the top of the
  screen and pressing 'enter' when done.
- **Matching item output area:** The box on the right side of the GUI displays the list of matching items for a given
  query. The user may navigate these using their mouse or the UP/DOWN arrow keys. Information about the current
  selected food item will be displayed in the message output area on the left.
- **Message output area:** The box on the left side of the application which notifies the user about the progress and outcomes of their requests.
  If a food item is selected from the matching item output area, information about it will be displayed here.
  If a request for nutrition data is made, the output will also be showed here.
- **Button for requesting nutrition data:** This button is located below the matching item output area and will only
  work if a food item entry is selected. If the user attempts to make a request without having selected an item,
  they will be notified that nothing has been selected in the message output area.
- **Button for requesting QR code:** This button is located below the matching item output area adjacent to the 
  button for requesting nutrition data. It will only work after the user has generated fresh results for nutrition 
  data for a selected food item at least once. From onwards, a user will then be able to request an Imgur link for 
  the QR code regardless of whether cached or fresh nutrition data results are used. It will default to using cached 
  data if a fresh request for nutrition data is not made.
  
**Decoding the contents of the QR code provided for a nutrition report**\
The website https://zxing.org/w/decode.jspx is a useful tool for decoding QR codes without having to use a phone 
camera. The developers are responsible also for the library used in this codebase for generating QR codes.

**Undefined behaviour around displaying report format**\
The format of the showm nutrition data/report is loosely based on the contents of a nutrition label as required under 
Australian law. Because of the size restrictions associated with uploading to Imgur, some less noteworthy data may 
be truncated (e.g. data about calories is not shown since this is represented by data about energy which measures 
the same thing) however the majority of it (particularly what is of importance that is not yet covered by 
information retrieved from a general Parser search) is preserved. It should be worth noting that the name of the food item 
from a Parser request may differ from a Nutrition request despite sharing the same food id, and it is not uncommon for this to occur.
For example, the same 'Crab' item from a Parser search yields the name 'Blue crab' for a Nutrition search. In following the specifications, 
the name of the food item received from a Nutrition search will not be modified to match what is shown in a Parser search.

**Undefined behaviour around caching conflicts of nutrition data and matching items**\
If there is ever conflict between caching the outcome from matching items or nutrition data based on the same search
term, the caching for the nutrition data will always prevail. Further, if there are multiple food items sharing the same name which are searched for and a cache hit is offered, the
database will return data for the first item that it accesses in its query. See this Ed thread for more details: https://edstem.org/courses/5417/discussion/497834

**Undefined behaviour for closing a pop-up for offering cached data**\
If the user is offered cached data for a query, a pop-up will appear asking them to make a choice between fresh and
cached results. If the user closes this pop-up, the program will default to making the query based on cached data. 
To select an option presented by the pop-up, the user may click the desired choice. Alternatively, they may navigate 
by using the TAB or LEFT/RIGHT keys and make their choice using the SPACE key (this is based on how JavaFX receives 
input)

**Restricting user input and timeout connection to API**\
Whenever the user interacts with a portion of the interface that makes a fresh request to an API or which could be disruptive to
tasks such as database querying, the application will temporarily grey-out these sections. This is aimed to prevent excessive 
user input and API request throttling. Upon completion of these tasks, access to these GUI sections will be restored. 
If an API request takes too long and fails, permit up to 10-15 seconds before the program notifies the user of the failed request
(e.g. failed requested, interrupted internet connection). In the scenario the application freezes beyond this period,
it may be necessary to restart it but should be highly unlikely given the defensive checks that have been implemented.


## Citations of code
For some components of code relating to making POST and GET HTTP requests for the API, structure for making sqlite
queries, and updating visual elements of the GUI which are not readily available in the relevant documentation, acknowledgement is given for the following sources
for providing a clearer idea of how to implement them. These citations are also present in the Javadocs for the
methods in the concerning classes.

**Controller class**
- Method for aligning the buttons in an alert box to be centralised - https://stackoverflow.com/questions/36009764/how-to-align-ok-button-of-a-dialog-pane-in-javafx
- Updating the text size of each entry in a ListView item - https://stackoverflow.com/questions/39620548/change-listview-font-size-in-javafx

**RequestClientImpl class**
- Method for sending a JSON file through a POST HTTP request - https://www.baeldung.com/httpurlconnection-post
- Method for sending byte data through a POST HTTP request - https://www.baeldung.com/httpurlconnection-post and https://stackoverflow.com/questions/2793150/how-to-use-java-net-urlconnection-to-fire-and-handle-http-requests/2793153#2793153

**ImgurApiTemplate class**
- Method generating QR code based on some provided data - https://www.callicoder.com/generate-qr-code-in-java-using-zxing/ and https://zxing.github.io/zxing/apidocs/index.html

**FoodAndNutritionDb class**
- General structure for writing functions related to sqlite jdbc queries - https://github.com/xerial/sqlite-jdbc

## Level of features claimed
The codebase has implemented features expected of the distinction level covering expected functionality specific to
the APIs, database caching, and concurrency. Note that for database caching, to improve usability for users, the 
program will cache and retrieve data in a way that is case insensitive and can filter for white spaces (e.g. a 
a cached search for 'apple' may be hit with a query of 'apple ' or 'APPLE').

## API dummy interaction - 'offline' access mode
For the Edamam API, 'offline' mode will return the same set of matching items regardless of the input provided and 
whenever nutrition data is requested for a selected item, the data returned will always be the same. These 
offline values will also be cached as per the specifications but may be updated by making a fresh request in the 
'online' access mode of the APIs. For the imgur API, 'offline' mode will always return the same URL link. 

## Javadoc
The codebase is documented with Javadoc which may be generated using the command 'gradle javadoc'

## Simple extension notice
This assignment took advantage of the simple extension provided
