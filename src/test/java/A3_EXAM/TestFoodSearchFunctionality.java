/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package A3_EXAM;

import A3_EXAM.model.database.FoodAndNutritionDbImpl;
import A3_EXAM.model.api.edamam.FoodDatabaseActualApi;
import A3_EXAM.model.api.edamam.FoodDatabaseDummyApi;
import A3_EXAM.model.api.imgur.ImgurApiTemplate;
import A3_EXAM.model.dataobject.FoodItemData;
import A3_EXAM.model.facade.ModelFacade;
import A3_EXAM.model.facade.ModelFacadeImpl;
import A3_EXAM.model.parsers.JSONParser;
import A3_EXAM.model.parsers.JSONParserImpl;
import A3_EXAM.model.parsers.ReportParser;
import A3_EXAM.model.parsers.ReportParserImpl;
import org.apache.commons.lang3.StringUtils;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mock;
import org.mockito.junit.MockitoJUnitRunner;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static org.junit.Assert.*;
import static org.mockito.Mockito.lenient;

@RunWith(MockitoJUnitRunner.class)

/**
 * Testing for the text-based food search functionality, including mocking for the real and dummy APIs
 */
public class TestFoodSearchFunctionality {

    private ModelFacade model;
    private JSONParser jsonParser;
    private ReportParser reportParserImpl;
    @Mock private FoodDatabaseActualApi foodApi;
    @Mock private FoodDatabaseDummyApi foodDummyApi;
    @Mock private ImgurApiTemplate imgurApi;
    @Mock private FoodAndNutritionDbImpl db;

    @Before
    public void setup() {
        jsonParser = new JSONParserImpl();
        reportParserImpl = new ReportParserImpl();
        model = new ModelFacadeImpl(foodApi, imgurApi, db, jsonParser, reportParserImpl);
    }

    @Test
    public void testHandleBadUserInput() {
        lenient().when(foodApi.foodSearchRequest("")).thenReturn("{\"error\":\"bad_request\",\"message\":\"Expected " +
                "exactly one" +
                " of ingredient text (ingr) or upc\"}");
        String foodSearch = model.foodSearchRequest("");
        assertEquals("Invalid input! Your query cannot be empty.", foodSearch);
        assertTrue(model.getFoodItemDataObjects("").isEmpty());
    }

    @Test
    public void testHandleAuthErrorFromApi() {
        lenient().when(foodApi.foodSearchRequest("blah")).thenReturn("{\"status\":\"error\"," +
                "\"message\":\"Unauthorized app_id = 5c8fcc5\"}");
        String foodSearch = model.foodSearchRequest("blah");
        assertEquals("Cannot access the Edamam food API! Unauthorised credentials (application ID and/or key) are " +
                "being used.", foodSearch);
    }

    @Test
    public void testAnyErrorFromApi() {
        lenient().when(foodApi.foodSearchRequest("testing")).thenReturn("{\"error\":\"not_found\"," +
                "\"message\":\"Unknown " +
                "command: /pser\"}");
        String foodSearch = model.foodSearchRequest("testing");
        assertEquals("Your request could not be processed! Please try again and make sure you have a stable internet connection.", foodSearch);
    }

    @Test
    public void testCreateDataItemObject() {
        model = new ModelFacadeImpl(foodDummyApi, imgurApi, db, jsonParser, reportParserImpl);
        lenient().when(foodDummyApi.foodSearchRequest("null")).thenReturn("{\"text\":\"null\",\"parsed\":[]," +
                "\"hints\":[{\"food\":{\"foodId\":\"food_boiukwdakoy1sbbnwa1j1azs1az0\",\"label\":\"Frigo Cheese Heads String Cheese Swirls - 8 CT\",\"nutrients\":{\"ENERC_KCAL\":291.6666666666667,\"PROCNT\":20.833333333333336,\"FIBTG\":12.5},\"brand\":\"null\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Pasteurized Part Skim Milk; Cream and Skim Milk; Cheese Cultures; Salt; Annatto Color; Enzymes.\",\"image\":\"https://www.edamam.com/food-img/be2/be295cf902e2edca068ab790a049cc18.jpg\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_container\",\"label\":\"Container\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]}]}");

        String apiResponse = model.foodSearchRequest("null");
        List<FoodItemData> data = model.getFoodItemDataObjects(apiResponse);
        assertEquals(1, data.size());
        FoodItemData foodItem = data.get(0);
        assertNotNull(foodItem);
        assertEquals("food_boiukwdakoy1sbbnwa1j1azs1az0", foodItem.getFoodId());
        assertEquals("Frigo Cheese Heads String Cheese Swirls - 8 CT", foodItem.getFoodLabel());
        assertEquals("Packaged foods", foodItem.getCategory());
        assertEquals("null", foodItem.getBrand());
        assertEquals("food", foodItem.getCategoryLabel());
        assertEquals("http://www.edamam.com/ontologies/edamam.owl#Measure_serving", foodItem.getMeasureUri());
        assertEquals("Serving", foodItem.getMeasure());
        assertEquals("https://www.edamam.com/food-img/be2/be295cf902e2edca068ab790a049cc18.jpg", foodItem.getImageLink());
        assertEquals(7, foodItem.getMeasures().size());
        assertEquals(3, foodItem.getBasicNutrients().size());


    }

    @Test
    public void testDisplayStrOfDataItemObjects() {

        lenient().when(foodApi.foodSearchRequest("app")).thenReturn("{\"text\":\"app\",\"parsed\":[],\"hints\":[{\"food\":{\"foodId\":\"food_bzvzpk8bjqsr7wa9fimylaz2j78u\",\"label\":\"Bon Appe, Nutella, Gourmet Fudge Brownie\",\"nutrients\":{\"ENERC_KCAL\":410,\"PROCNT\":5.130000114440918,\"FAT\":20.510000228881836,\"CHOCDF\":53.849998474121094,\"FIBTG\":2.5999999046325684},\"brand\":\"Nutella\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"SUGAR; NUTELLA (SUGAR; PALM OIL; HAZELNUTS; COCOA; SKIM MILK; WHEY; SOY LECITHIN; VANILLIN); ENRICHED BLEACHED FLOUR (WHEAT FLOUR; CHLORINE; NIACIN; BENZOYL PEROXIDE; REDUCED IRON; THIAMINE MONONITRATE; RIBOFLAVIN; FOLIC ACID); SOYBEAN AND/OR CANOLA OIL; EGGS; WATER; COCOA POWDER (ALKALIZED); INVERT SUGAR; SALT; ARTIFICIAL FLAVOR.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_slice\",\"label\":\"Slice\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_bb0042jbjvdqatacn9c4cas5trmz\",\"label\":\"Gogo Squeez Applesauce Vty App/Cinn 3.2oz 20pk\",\"nutrients\":{\"ENERC_KCAL\":77.77777777777779,\"PROCNT\":0,\"FAT\":0,\"CHOCDF\":17.77777777777778,\"FIBTG\":3.3333333333333335},\"brand\":\"GoGo Squeez\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Apple Apple : Apple; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Cinnamon : Apple; Apple Puree Concentrate; Lemon Juice Concentrate; Cinnamon.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"label\":\"Whole\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_aiholehb8m60fbbvql02mabvp8m0\",\"label\":\"Gogo Squeez Applesauce Vty App/Ban/Mang 3.2oz 20pk\",\"nutrients\":{\"ENERC_KCAL\":77.77777777777779,\"PROCNT\":0,\"FAT\":0,\"CHOCDF\":17.77777777777778,\"FIBTG\":3.3333333333333335},\"brand\":\"GoGo Squeez\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Apple Apple : Apple; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Banana : Apple; Banana; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Mango : Apple; Mango; Apple Puree Concentrate; Lemon Juice Concentrate.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"label\":\"Whole\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_bbs5150aqik3g0ak8voa9ad6xrke\",\"label\":\"Gogo Squeez Applesauce Vty App/Pch/Gimme5 3.2oz 20pk\",\"nutrients\":{\"ENERC_KCAL\":77.77777777777779,\"PROCNT\":0,\"FAT\":0,\"CHOCDF\":17.77777777777778,\"FIBTG\":3.3333333333333335},\"brand\":\"GoGo Squeez\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Apple Apple : Apple; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Peach : Apple; Peach; Apple Puree Concentrate; Lemon Juice Concentrate. Gimme Five : Apple; Apple Puree Concentrate; Mango; Strawberry; Peach; Banana.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"label\":\"Whole\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_b7nwtlybbcgs6dbrmtj1jafrz50q\",\"label\":\"Gogo Squeez Applesauce Vty App/Ban/Straw 3.2oz 20pk\",\"nutrients\":{\"ENERC_KCAL\":77.77777777777779,\"PROCNT\":0,\"FAT\":0,\"CHOCDF\":17.77777777777778,\"FIBTG\":3.3333333333333335},\"brand\":\"GoGo Squeez\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Apple Apple : Apple; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Banana : Apple; Banana; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Strawberry : Apple; Apple Puree Concentrate; Strawberry; Blackcurrant.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]}]}");

        String apiResponse = model.foodSearchRequest("app");
        List<FoodItemData> data = model.getFoodItemDataObjects(apiResponse);

        FoodItemData foodItem = data.get(0);

        String s = "Information about 'Bon Appe, Nutella, Gourmet Fudge Brownie'\n" +
                "Brand: Nutella\n" +
                "Category: Packaged foods\n" +
                "Item type: Food\n" +
                "Measure(s): Serving, Slice, Gram, Ounce, Pound, Kilogram\n" +
                "Food ID: food_bzvzpk8bjqsr7wa9fimylaz2j78u\n" +
                "Food URI: N/A\n" +
                "Image link: N/A\n" +
                "Yielding search term: app\n" +
                "Nutrition overview:\n" +
                "\tEnergy: 410 kcal\n" +
                "\tProtein: 5.13 mg\n" +
                "\tFat: 20.51 g\n" +
                "\tCarbs: 53.85 g\n" +
                "\tFiber: 2.6 g\n";

        assertEquals(s, foodItem.displayUponBeingSelected());
        assertEquals("Bon Appe, Nutella, Gourmet Fudge Brownie (Packaged foods by Nutella)", foodItem.displayUponMatchingResult());
        assertEquals("app", foodItem.getYieldingSearchTerm());

        foodItem.setBrand("N/A");
        String s2 = "Information about 'Bon Appe, Nutella, Gourmet Fudge Brownie'\n" +
                "Brand: N/A\n" +
                "Category: Packaged foods\n" +
                "Item type: Food\n" +
                "Measure(s): Serving, Slice, Gram, Ounce, Pound, Kilogram\n" +
                "Food ID: food_bzvzpk8bjqsr7wa9fimylaz2j78u\n" +
                "Food URI: N/A\n" +
                "Image link: N/A\n" +
                "Yielding search term: app\n" +
                "Nutrition overview:\n" +
                "\tEnergy: 410 kcal\n" +
                "\tProtein: 5.13 mg\n" +
                "\tFat: 20.51 g\n" +
                "\tCarbs: 53.85 g\n" +
                "\tFiber: 2.6 g\n";
        assertEquals(s2, foodItem.displayUponBeingSelected());
        assertEquals("Bon Appe, Nutella, Gourmet Fudge Brownie (Packaged foods)", foodItem.displayUponMatchingResult());
        assertEquals("app", foodItem.getYieldingSearchTerm());

        Map<String, Float> emptyNutrients = new HashMap<>();
        foodItem.setBasicNutrients(emptyNutrients);
        assertTrue(foodItem.displayUponBeingSelected().contains("Nutrition overview: N/A"));

    }

    @Test
    public void testCreateDataItemObjects() {
        lenient().when(foodApi.foodSearchRequest("app")).thenReturn("{\"text\":\"app\",\"parsed\":[],\"hints\":[{\"food\":{\"foodId\":\"food_bzvzpk8bjqsr7wa9fimylaz2j78u\",\"label\":\"Bon Appe, Nutella, Gourmet Fudge Brownie\",\"nutrients\":{\"ENERC_KCAL\":410,\"PROCNT\":5.130000114440918,\"FAT\":20.510000228881836,\"CHOCDF\":53.849998474121094,\"FIBTG\":2.5999999046325684},\"brand\":\"Nutella\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"SUGAR; NUTELLA (SUGAR; PALM OIL; HAZELNUTS; COCOA; SKIM MILK; WHEY; SOY LECITHIN; VANILLIN); ENRICHED BLEACHED FLOUR (WHEAT FLOUR; CHLORINE; NIACIN; BENZOYL PEROXIDE; REDUCED IRON; THIAMINE MONONITRATE; RIBOFLAVIN; FOLIC ACID); SOYBEAN AND/OR CANOLA OIL; EGGS; WATER; COCOA POWDER (ALKALIZED); INVERT SUGAR; SALT; ARTIFICIAL FLAVOR.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_slice\",\"label\":\"Slice\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_bb0042jbjvdqatacn9c4cas5trmz\",\"label\":\"Gogo Squeez Applesauce Vty App/Cinn 3.2oz 20pk\",\"nutrients\":{\"ENERC_KCAL\":77.77777777777779,\"PROCNT\":0,\"FAT\":0,\"CHOCDF\":17.77777777777778,\"FIBTG\":3.3333333333333335},\"brand\":\"GoGo Squeez\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Apple Apple : Apple; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Cinnamon : Apple; Apple Puree Concentrate; Lemon Juice Concentrate; Cinnamon.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"label\":\"Whole\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_aiholehb8m60fbbvql02mabvp8m0\",\"label\":\"Gogo Squeez Applesauce Vty App/Ban/Mang 3.2oz 20pk\",\"nutrients\":{\"ENERC_KCAL\":77.77777777777779,\"PROCNT\":0,\"FAT\":0,\"CHOCDF\":17.77777777777778,\"FIBTG\":3.3333333333333335},\"brand\":\"GoGo Squeez\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Apple Apple : Apple; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Banana : Apple; Banana; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Mango : Apple; Mango; Apple Puree Concentrate; Lemon Juice Concentrate.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"label\":\"Whole\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_bbs5150aqik3g0ak8voa9ad6xrke\",\"label\":\"Gogo Squeez Applesauce Vty App/Pch/Gimme5 3.2oz 20pk\",\"nutrients\":{\"ENERC_KCAL\":77.77777777777779,\"PROCNT\":0,\"FAT\":0,\"CHOCDF\":17.77777777777778,\"FIBTG\":3.3333333333333335},\"brand\":\"GoGo Squeez\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Apple Apple : Apple; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Peach : Apple; Peach; Apple Puree Concentrate; Lemon Juice Concentrate. Gimme Five : Apple; Apple Puree Concentrate; Mango; Strawberry; Peach; Banana.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"label\":\"Whole\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_b7nwtlybbcgs6dbrmtj1jafrz50q\",\"label\":\"Gogo Squeez Applesauce Vty App/Ban/Straw 3.2oz 20pk\",\"nutrients\":{\"ENERC_KCAL\":77.77777777777779,\"PROCNT\":0,\"FAT\":0,\"CHOCDF\":17.77777777777778,\"FIBTG\":3.3333333333333335},\"brand\":\"GoGo Squeez\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Apple Apple : Apple; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Banana : Apple; Banana; Apple Puree Concentrate; Lemon Juice Concentrate. Apple Strawberry : Apple; Apple Puree Concentrate; Strawberry; Blackcurrant.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]}]}");

        String apiResponse = model.foodSearchRequest("app");
        List<FoodItemData> data = model.getFoodItemDataObjects(apiResponse);

        assertEquals(5, data.size());

        for (FoodItemData fd : data) {
            assertEquals("N/A", fd.getImageLink());
        }

        FoodItemData foodItem1 = data.get(0);
        assertEquals("food_bzvzpk8bjqsr7wa9fimylaz2j78u", foodItem1.getFoodId());
        assertEquals("Bon Appe, Nutella, Gourmet Fudge Brownie", foodItem1.getFoodLabel());
        assertEquals("Packaged foods", foodItem1.getCategory());
        assertEquals("Nutella", foodItem1.getBrand());
        assertEquals("food", foodItem1.getCategoryLabel());
        assertEquals("http://www.edamam.com/ontologies/edamam.owl#Measure_serving", foodItem1.getMeasureUri());
        assertEquals("Serving", foodItem1.getMeasure());
        assertEquals("Serving, Slice, Gram, Ounce, Pound, Kilogram", StringUtils.join(foodItem1.getMeasures(), ", "));

        FoodItemData foodItem2 = data.get(1);
        assertEquals("food_bb0042jbjvdqatacn9c4cas5trmz", foodItem2.getFoodId());
        assertEquals("Gogo Squeez Applesauce Vty App/Cinn 3.2oz 20pk", foodItem2.getFoodLabel());
        assertEquals("Packaged foods", foodItem2.getCategory());
        assertEquals("GoGo Squeez", foodItem2.getBrand());
        assertEquals("food", foodItem2.getCategoryLabel());
        assertEquals("http://www.edamam.com/ontologies/edamam.owl#Measure_serving", foodItem2.getMeasureUri());
        assertEquals("Serving", foodItem2.getMeasure());
        assertEquals("Serving, Whole, Package, Gram, Ounce, Pound, Kilogram", StringUtils.join(foodItem2.getMeasures(), ", "));

        FoodItemData foodItem3 = data.get(2);
        assertEquals("food_aiholehb8m60fbbvql02mabvp8m0", foodItem3.getFoodId());
        assertEquals("Gogo Squeez Applesauce Vty App/Ban/Mang 3.2oz 20pk", foodItem3.getFoodLabel());
        assertEquals("Packaged foods", foodItem3.getCategory());
        assertEquals("GoGo Squeez", foodItem3.getBrand());
        assertEquals("food", foodItem3.getCategoryLabel());
        assertEquals("http://www.edamam.com/ontologies/edamam.owl#Measure_serving", foodItem3.getMeasureUri());
        assertEquals("Serving", foodItem3.getMeasure());
        assertEquals("Serving, Whole, Package, Gram, Ounce, Pound, Kilogram",
                StringUtils.join(foodItem3.getMeasures(), ", "));

        FoodItemData foodItem4 = data.get(3);
        assertEquals("food_bbs5150aqik3g0ak8voa9ad6xrke", foodItem4.getFoodId());
        assertEquals("Gogo Squeez Applesauce Vty App/Pch/Gimme5 3.2oz 20pk", foodItem4.getFoodLabel());
        assertEquals("Packaged foods", foodItem4.getCategory());
        assertEquals("GoGo Squeez", foodItem4.getBrand());
        assertEquals("food", foodItem4.getCategoryLabel());
        assertEquals("http://www.edamam.com/ontologies/edamam.owl#Measure_serving", foodItem4.getMeasureUri());
        assertEquals("Serving", foodItem4.getMeasure());
        assertEquals("Serving, Whole, Package, Gram, Ounce, Pound, Kilogram",
                StringUtils.join(foodItem4.getMeasures(), ", "));

        FoodItemData foodItem5 = data.get(4);
        assertEquals("food_b7nwtlybbcgs6dbrmtj1jafrz50q", foodItem5.getFoodId());
        assertEquals("Gogo Squeez Applesauce Vty App/Ban/Straw 3.2oz 20pk", foodItem5.getFoodLabel());
        assertEquals("Packaged foods", foodItem5.getCategory());
        assertEquals("GoGo Squeez", foodItem5.getBrand());
        assertEquals("food", foodItem5.getCategoryLabel());
        assertEquals("http://www.edamam.com/ontologies/edamam.owl#Measure_serving", foodItem5.getMeasureUri());
        assertEquals("Serving", foodItem5.getMeasure());
        assertEquals("Serving, Gram, Ounce, Pound, Kilogram",
                StringUtils.join(foodItem5.getMeasures(), ", "));


    }

    @Test
    public void testCreateItemObjectsFromDummyResponse() {
        model = new ModelFacadeImpl(foodDummyApi, imgurApi, db, jsonParser, reportParserImpl);
        lenient().when(foodDummyApi.foodSearchRequest("foo")).thenReturn("{\"text\":\"test\",\"parsed\":[]," +
                "\"hints\":[{\"food\":{\"foodId\":\"food_bc5dzpwbyzxcs7bgwka4va8lzajp\",\"label\":\"Bestrecipes Test Kitchen Recipes\",\"nutrients\":{\"ENERC_KCAL\":121.8754269088463,\"PROCNT\":1.8775544280294882,\"FAT\":5.877685341302945,\"CHOCDF\":15.885042566763591,\"FIBTG\":2.1062216232630897},\"category\":\"Generic meals\",\"categoryLabel\":\"meal\",\"foodContentsLabel\":\"mayonnaise; green onion; salt; pepper; potatoes\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"label\":\"Whole\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_bk6goo7bkb4utbajbrx1lav6e0vm\",\"label\":\"Doritos - Jacked Test Flavor - 2 Blue\",\"nutrients\":{\"ENERC_KCAL\":500.0,\"PROCNT\":7.142857142857143,\"FAT\":32.142857142857146,\"CHOCDF\":57.142857142857146,\"FIBTG\":3.5714285714285716},\"brand\":\"Doritos\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Potatoes; Vegetable Oil ( Peanut Oil; Corn Oil; Sunflower Oil ); Salt; Monterey Jack; Blue And Cheddar Cheese ( Pasteurized Milk; Cheese Cultures; Salt; Enzymes ); Maltodextrin; Partially Hydrogenated Soybean Oil; Whey; Spices; Nonfat Dry Milk; Citric Acid; Natural Flavor; Disodium Inosinate And Guanylate.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_chip\",\"label\":\"Chip\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_ak1wzakaewqa7lbgb6r3iadtykp5\",\"label\":\"Lamb, New Zealand, Imported, Testes, Raw\",\"nutrients\":{\"ENERC_KCAL\":68.0,\"PROCNT\":11.4,\"FAT\":2.38,\"CHOCDF\":0.14,\"FIBTG\":0.0},\"category\":\"Generic foods\",\"categoryLabel\":\"food\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_agj0tq8a3bcw7abjn0g1pbkylwfh\",\"label\":\"Doritos - Jacked Test Flavor - 3 Yellow\",\"nutrients\":{\"ENERC_KCAL\":500.0,\"PROCNT\":7.142857142857143,\"FAT\":28.571428571428573,\"CHOCDF\":57.142857142857146,\"FIBTG\":3.5714285714285716},\"brand\":\"Doritos\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Potatoes; Vegetable Oil ( Peanut Oil; Corn Oil; Sunflower Oil ); Salt; Monterey Jack; Blue And Cheddar Cheese ( Pasteurized Milk; Cheese Cultures; Salt; Enzymes ); Maltodextrin; Partially Hydrogenated Soybean Oil; Whey; Spices; Nonfat Dry Milk; Citric Acid; Natural Flavor; Disodium Inosinate And Guanylate.\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_chip\",\"label\":\"Chip\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_bqfr6d0b5zbddha01ldp9a1lqdv3\",\"label\":\"Lamb, New Zealand, Imported, Testes, Cooked, Soaked and Fried\",\"nutrients\":{\"ENERC_KCAL\":125.0,\"PROCNT\":21.01,\"FAT\":4.56,\"CHOCDF\":0.0,\"FIBTG\":0.0},\"category\":\"Generic foods\",\"categoryLabel\":\"food\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"}]},{\"food\":{\"foodId\":\"food_aczjd0ubsgtbpoa5b64y8bdcfosv\",\"label\":\"Legal Gear Lgp 1 - t Hydroxy - Test 8.11 fl Oz\",\"nutrients\":{\"ENERC_KCAL\":0.0,\"PROCNT\":0.0,\"FAT\":0.0,\"CHOCDF\":0.0},\"brand\":\"Legal Gear\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Isopropyl Alcohol; Water; Acetic Acid; Propylene Glycol; D - Limone; Isopropyl Myristate; Chitosan; 4 - Androstenediol; 1 - Andrsotene - 17b - Ol - 3 - One; 4 - Androstene4; 17b - Ol - 3 - One\",\"image\":\"https://www.edamam.com/food-img/31b/31b81d4b8ec849e53858b690a3c53d55.jpg\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edaam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_milliliter\",\"label\":\"Milliliter\"}]},{\"food\":{\"foodId\":\"food_b0cv847au8oooobk5e6l0bxef5lh\",\"label\":\"Met - rx hi - Test Amino Liquid Wild Cherry 16 fl Oz\",\"nutrients\":{\"ENERC_KCAL\":202.88413621448817,\"PROCNT\":50.72103405362204,\"FAT\":0.0,\"CHOCDF\":0.0},\"brand\":\"MET-Rx USA, Inc.\",\"category\":\"Packaged foods\",\"categoryLabel\":\"food\",\"foodContentsLabel\":\"Purified Water; Hydrolyzed Gelatin ( Collagen ); Citric Acid; Artificial Flavor; Sodium Benzoate ( Preservative ); Potassium Sorbate ( Preservative ).\",\"image\":\"https://www.edamam.com/food-img/718/718029b9a42a7dc3a913b5873c54cc49.jpg\"},\"measures\":[{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_serving\",\"label\":\"Serving\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_package\",\"label\":\"Package\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_gram\",\"label\":\"Gram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_ounce\",\"label\":\"Ounce\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_pound\",\"label\":\"Pound\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_kilogram\",\"label\":\"Kilogram\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_tablespoon\",\"label\":\"Tablespoon\"},{\"uri\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_milliliter\",\"label\":\"Milliliter\"}]}]}\n");

        String apiResponse = model.foodSearchRequest("foo");
        List<FoodItemData> data = model.getFoodItemDataObjects(apiResponse);
        assertEquals(7, data.size());
    }

    @Test
    public void testCreateNoDataItemObjectsFromEmptyQuery() {
        lenient().when(foodApi.foodSearchRequest("thisshouldreturnnothing")).thenReturn("{\"text\":\"thisshouldreturnnothing\"," +
                "\"parsed\":[],\"hints\":[]}");
        String apiResponse = model.foodSearchRequest("thisshouldreturnnothing");
        List<FoodItemData> data = model.getFoodItemDataObjects(apiResponse);
        assertEquals(0, data.size());
    }


}
