package A3_EXAM;

import A3_EXAM.model.api.edamam.FoodDatabaseActualApi;
import A3_EXAM.model.api.edamam.FoodDatabaseDummyApi;
import A3_EXAM.model.api.imgur.ImgurActualApi;
import A3_EXAM.model.api.imgur.ImgurDummyApi;
import A3_EXAM.model.commands.Command;
import A3_EXAM.model.commands.CompareItemEnergyWithMaxCaloriesQuery;
import A3_EXAM.model.commands.FoodItemNutrientSearchQuery;
import A3_EXAM.model.database.FoodAndNutritionDb;
import A3_EXAM.model.dataobject.FoodItemData;
import A3_EXAM.model.dataobject.FoodItemDataImpl;
import A3_EXAM.model.dataobject.FoodItemNutrientData;
import A3_EXAM.model.dataobject.NutrientData;
import A3_EXAM.model.facade.ModelFacade;
import A3_EXAM.model.facade.ModelFacadeImpl;
import A3_EXAM.model.parsers.JSONParser;
import A3_EXAM.model.parsers.JSONParserImpl;
import A3_EXAM.model.parsers.ReportParser;
import A3_EXAM.model.parsers.ReportParserImpl;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mock;
import org.mockito.junit.MockitoJUnitRunner;

import java.util.ArrayList;
import java.util.List;

import static org.junit.Assert.*;
import static org.mockito.Mockito.lenient;

@RunWith(MockitoJUnitRunner.class)
public class TestCommandQueriesForComparingItemEnergyWithMaxCalories {

    private ModelFacade model;
    private JSONParser jsonParser;
    private ReportParser reportParserImpl;
    private List<FoodItemData> fidList;
    private FoodItemData foodItem;
    private Command compareItemEnergyWithMaxCaloriesQuery;
    private Command foodNutrientDataQuery;
    private StringBuilder sb;

    @Mock private FoodAndNutritionDb db;
    @Mock private FoodDatabaseActualApi foodApi;
    @Mock private FoodDatabaseDummyApi foodDummyApi;
    @Mock private ImgurActualApi imgurApi;
    @Mock private ImgurDummyApi imgurDummyApi;


    @Before
    public void setup() {
        jsonParser = new JSONParserImpl();
        reportParserImpl = new ReportParserImpl();
        model = new ModelFacadeImpl(foodApi, imgurApi, db, jsonParser, reportParserImpl);
        fidList = new ArrayList<>();
        foodItem = new FoodItemDataImpl();
        sb = new StringBuilder();
    }

    @Test
    public void testFalseStatusWhenFoodItemBelowMaxCalorie() {

        model = new ModelFacadeImpl(foodDummyApi, imgurDummyApi, db, jsonParser, reportParserImpl);
        lenient().when(foodDummyApi.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376")).thenReturn("{\"uri\":\"http://www.edamam" +
                ".com/ontologies/edamam.owl#9f31eef6-10f2-42ce-9c77-d536956be15e\",\"calories\":113,\"totalWeight\":28,\"dietLabels\":[],\"healthLabels\":[\"KETO_FRIENDLY\",\"VEGETARIAN\",\"PESCATARIAN\",\"SPECIFIC_CARBS\",\"GLUTEN_FREE\",\"WHEAT_FREE\",\"EGG_FREE\",\"PEANUT_FREE\",\"TREE_NUT_FREE\",\"SOY_FREE\",\"FISH_FREE\",\"SHELLFISH_FREE\",\"PORK_FREE\",\"RED_MEAT_FREE\",\"CRUSTACEAN_FREE\",\"CELERY_FREE\",\"MUSTARD_FREE\",\"SESAME_FREE\",\"LUPINE_FREE\",\"MOLLUSK_FREE\",\"ALCOHOL_FREE\",\"NO_OIL_ADDED\",\"NO_SUGAR_ADDED\",\"KOSHER\"],\"cautions\":[\"SULFITES\"],\"totalNutrients\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":113.68,\"unit\":\"kcal\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":9.469600000000002,\"unit\":\"g\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":5.42304,\"unit\":\"g\"},\"FATRN\":{\"label\":\"Trans\",\"quantity\":0.33012,\"unit\":\"g\"},\"FAMS\":{\"label\":\"Monounsaturated\",\"quantity\":2.3598400000000006,\"unit\":\"g\"},\"FAPU\":{\"label\":\"Polyunsaturated\",\"quantity\":0.40124000000000004,\"unit\":\"g\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.37240000000000006,\"unit\":\"g\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"g\"},\"SUGAR\":{\"label\":\"Sugars\",\"quantity\":0.07840000000000001,\"unit\":\"g\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":6.7312,\"unit\":\"g\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":28.560000000000002,\"unit\":\"mg\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":180.32000000000002,\"unit\":\"mg\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":189.00000000000003,\"unit\":\"mg\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":7.5600000000000005,\"unit\":\"mg\"},\"K\":{\"label\":\"Potassium\",\"quantity\":21.28,\"unit\":\"mg\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.044800000000000006,\"unit\":\"mg\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":0.9604000000000001,\"unit\":\"mg\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":132.44000000000003,\"unit\":\"mg\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":73.64,\"unit\":\"µg\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"mg\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.007560000000000001,\"unit\":\"mg\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":0.12152000000000002,\"unit\":\"mg\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.010920000000000001,\"unit\":\"mg\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":0.013720000000000001,\"unit\":\"mg\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLFD\":{\"label\":\"Folate (food)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLAC\":{\"label\":\"Folic acid\",\"quantity\":0,\"unit\":\"µg\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":0.24640000000000004,\"unit\":\"µg\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":0.168,\"unit\":\"µg\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":0.21840000000000004,\"unit\":\"mg\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.812,\"unit\":\"µg\"},\"WATER\":{\"label\":\"Water\",\"quantity\":10.388000000000002,\"unit\":\"g\"}},\"totalDaily\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":5.684,\"unit\":\"%\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":14.568615384615386,\"unit\":\"%\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":27.115200000000005,\"unit\":\"%\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.12413333333333336,\"unit\":\"%\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"%\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":13.4624,\"unit\":\"%\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":9.52,\"unit\":\"%\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":7.5133333333333345,\"unit\":\"%\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":18.900000000000002,\"unit\":\"%\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":1.8,\"unit\":\"%\"},\"K\":{\"label\":\"Potassium\",\"quantity\":0.45276595744680853,\"unit\":\"%\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.2488888888888889,\"unit\":\"%\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":8.730909090909092,\"unit\":\"%\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":18.92,\"unit\":\"%\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":8.182222222222222,\"unit\":\"%\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"%\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.6300000000000001,\"unit\":\"%\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":9.347692307692308,\"unit\":\"%\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.06825,\"unit\":\"%\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":1.0553846153846154,\"unit\":\"%\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":1.8200000000000003,\"unit\":\"%\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":10.26666666666667,\"unit\":\"%\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":1.12,\"unit\":\"%\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":1.4560000000000002,\"unit\":\"%\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.6766666666666666,\"unit\":\"%\"}},\"ingredients\":[{\"parsed\":[{\"quantity\":1,\"measure\":\"whole\",\"food\":\"cheddar cheese\",\"foodId\":\"food_bhppgmha1u27voagb8eptbp9g376\",\"weight\":28,\"retainedWeight\":28,\"servingsPerContainer\":7.071428571428571,\"measureURI\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"status\":\"OK\"}]}]}");
        FoodItemNutrientData nutrientData = model.getFoodItemNutrientData(model.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376"));
        foodItem.setFoodId("food_bhppgmha1u27voagb8eptbp9g376");
        foodItem.setMeasureUri("http://www.edamam.com/ontologies/edamam.owl#Measure_unit");
        foodNutrientDataQuery = new FoodItemNutrientSearchQuery(model, sb, foodItem);
        foodNutrientDataQuery.execute();
        lenient().when(db.fetchSelectedItemNutrientData(foodItem.getFoodId(), foodItem.getFoodLabel())).thenReturn(nutrientData);
        FoodItemNutrientData fd = model.fetchFoodItemNutrientDataBySelection(foodItem.getFoodId(), foodItem.getFoodLabel());

        model.setMaxCalorieAmount(150);
        assertEquals(150, model.getMaxCalorieAmount());
        assertFalse(model.checkFoodItemExceedsMaxCalories());
        model.setNutrientDataOfFoodItem(fd);
        CompareItemEnergyWithMaxCaloriesQuery compareItemEnergyWithMaxCaloriesQuery = new CompareItemEnergyWithMaxCaloriesQuery(model, sb);
        compareItemEnergyWithMaxCaloriesQuery.execute();
        assertFalse(model.checkFoodItemExceedsMaxCalories());
    }

    @Test
    public void testStatusWhenComparingFloatEnergyValueToIntegerMaxCalories() {

        model = new ModelFacadeImpl(foodDummyApi, imgurDummyApi, db, jsonParser, reportParserImpl);
        lenient().when(foodDummyApi.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376")).thenReturn("{\"uri\":\"http://www.edamam" +
                ".com/ontologies/edamam.owl#9f31eef6-10f2-42ce-9c77-d536956be15e\",\"calories\":50.1,\"totalWeight\":28,\"dietLabels\":[]," +
                "\"healthLabels\":[\"KETO_FRIENDLY\",\"VEGETARIAN\",\"PESCATARIAN\",\"SPECIFIC_CARBS\",\"GLUTEN_FREE\",\"WHEAT_FREE\",\"EGG_FREE\"," +
                "\"PEANUT_FREE\",\"TREE_NUT_FREE\",\"SOY_FREE\",\"FISH_FREE\",\"SHELLFISH_FREE\",\"PORK_FREE\",\"RED_MEAT_FREE\"," +
                "\"CRUSTACEAN_FREE\",\"CELERY_FREE\",\"MUSTARD_FREE\",\"SESAME_FREE\",\"LUPINE_FREE\",\"MOLLUSK_FREE\",\"ALCOHOL_FREE\"," +
                "\"NO_OIL_ADDED\",\"NO_SUGAR_ADDED\",\"KOSHER\"],\"cautions\":[\"SULFITES\"]," +
                "\"totalNutrients\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":50.1,\"unit\":\"kcal\"},\"FAT\":{\"label\":\"Fat\"," +
                "\"quantity\":9.469600000000002,\"unit\":\"g\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":5.42304,\"unit\":\"g\"},\"FATRN\":{\"label\":\"Trans\",\"quantity\":0.33012,\"unit\":\"g\"},\"FAMS\":{\"label\":\"Monounsaturated\",\"quantity\":2.3598400000000006,\"unit\":\"g\"},\"FAPU\":{\"label\":\"Polyunsaturated\",\"quantity\":0.40124000000000004,\"unit\":\"g\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.37240000000000006,\"unit\":\"g\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"g\"},\"SUGAR\":{\"label\":\"Sugars\",\"quantity\":0.07840000000000001,\"unit\":\"g\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":6.7312,\"unit\":\"g\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":28.560000000000002,\"unit\":\"mg\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":180.32000000000002,\"unit\":\"mg\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":189.00000000000003,\"unit\":\"mg\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":7.5600000000000005,\"unit\":\"mg\"},\"K\":{\"label\":\"Potassium\",\"quantity\":21.28,\"unit\":\"mg\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.044800000000000006,\"unit\":\"mg\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":0.9604000000000001,\"unit\":\"mg\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":132.44000000000003,\"unit\":\"mg\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":73.64,\"unit\":\"µg\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"mg\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.007560000000000001,\"unit\":\"mg\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":0.12152000000000002,\"unit\":\"mg\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.010920000000000001,\"unit\":\"mg\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":0.013720000000000001,\"unit\":\"mg\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLFD\":{\"label\":\"Folate (food)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLAC\":{\"label\":\"Folic acid\",\"quantity\":0,\"unit\":\"µg\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":0.24640000000000004,\"unit\":\"µg\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":0.168,\"unit\":\"µg\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":0.21840000000000004,\"unit\":\"mg\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.812,\"unit\":\"µg\"},\"WATER\":{\"label\":\"Water\",\"quantity\":10.388000000000002,\"unit\":\"g\"}},\"totalDaily\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":5.684,\"unit\":\"%\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":14.568615384615386,\"unit\":\"%\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":27.115200000000005,\"unit\":\"%\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.12413333333333336,\"unit\":\"%\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"%\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":13.4624,\"unit\":\"%\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":9.52,\"unit\":\"%\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":7.5133333333333345,\"unit\":\"%\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":18.900000000000002,\"unit\":\"%\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":1.8,\"unit\":\"%\"},\"K\":{\"label\":\"Potassium\",\"quantity\":0.45276595744680853,\"unit\":\"%\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.2488888888888889,\"unit\":\"%\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":8.730909090909092,\"unit\":\"%\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":18.92,\"unit\":\"%\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":8.182222222222222,\"unit\":\"%\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"%\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.6300000000000001,\"unit\":\"%\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":9.347692307692308,\"unit\":\"%\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.06825,\"unit\":\"%\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":1.0553846153846154,\"unit\":\"%\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":1.8200000000000003,\"unit\":\"%\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":10.26666666666667,\"unit\":\"%\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":1.12,\"unit\":\"%\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":1.4560000000000002,\"unit\":\"%\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.6766666666666666,\"unit\":\"%\"}},\"ingredients\":[{\"parsed\":[{\"quantity\":1,\"measure\":\"whole\",\"food\":\"cheddar cheese\",\"foodId\":\"food_bhppgmha1u27voagb8eptbp9g376\",\"weight\":28,\"retainedWeight\":28,\"servingsPerContainer\":7.071428571428571,\"measureURI\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"status\":\"OK\"}]}]}");
        FoodItemNutrientData nutrientData = model.getFoodItemNutrientData(model.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376"));
        foodItem.setFoodId("food_bhppgmha1u27voagb8eptbp9g376");
        foodItem.setMeasureUri("http://www.edamam.com/ontologies/edamam.owl#Measure_unit");
        foodNutrientDataQuery = new FoodItemNutrientSearchQuery(model, sb, foodItem);
        foodNutrientDataQuery.execute();
        lenient().when(db.fetchSelectedItemNutrientData(foodItem.getFoodId(), foodItem.getFoodLabel())).thenReturn(nutrientData);
        FoodItemNutrientData fd = model.fetchFoodItemNutrientDataBySelection(foodItem.getFoodId(), foodItem.getFoodLabel());

        float foodItemCalories = 0;
        for (NutrientData nd : fd.getTotalNutrients()) {
            if (nd.getNutrientLabel().equalsIgnoreCase("energy")) {
                foodItemCalories = nd.getQuantity();
            }
        }


        assertEquals(50.1, foodItemCalories, 0.01);

        model.setMaxCalorieAmount(50);
        assertEquals(50, model.getMaxCalorieAmount());
        assertFalse(model.checkFoodItemExceedsMaxCalories());
        model.setNutrientDataOfFoodItem(fd);
        CompareItemEnergyWithMaxCaloriesQuery compareItemEnergyWithMaxCaloriesQuery = new CompareItemEnergyWithMaxCaloriesQuery(model, sb);
        compareItemEnergyWithMaxCaloriesQuery.execute();
        assertTrue(model.checkFoodItemExceedsMaxCalories());


    }

    @Test
    public void testFalseStatusWhenFoodItemAboveMaxCalorie() {

        model = new ModelFacadeImpl(foodDummyApi, imgurDummyApi, db, jsonParser, reportParserImpl);
        lenient().when(foodDummyApi.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376")).thenReturn("{\"uri\":\"http://www.edamam" +
                ".com/ontologies/edamam.owl#9f31eef6-10f2-42ce-9c77-d536956be15e\",\"calories\":113,\"totalWeight\":28,\"dietLabels\":[],\"healthLabels\":[\"KETO_FRIENDLY\",\"VEGETARIAN\",\"PESCATARIAN\",\"SPECIFIC_CARBS\",\"GLUTEN_FREE\",\"WHEAT_FREE\",\"EGG_FREE\",\"PEANUT_FREE\",\"TREE_NUT_FREE\",\"SOY_FREE\",\"FISH_FREE\",\"SHELLFISH_FREE\",\"PORK_FREE\",\"RED_MEAT_FREE\",\"CRUSTACEAN_FREE\",\"CELERY_FREE\",\"MUSTARD_FREE\",\"SESAME_FREE\",\"LUPINE_FREE\",\"MOLLUSK_FREE\",\"ALCOHOL_FREE\",\"NO_OIL_ADDED\",\"NO_SUGAR_ADDED\",\"KOSHER\"],\"cautions\":[\"SULFITES\"],\"totalNutrients\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":113.68,\"unit\":\"kcal\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":9.469600000000002,\"unit\":\"g\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":5.42304,\"unit\":\"g\"},\"FATRN\":{\"label\":\"Trans\",\"quantity\":0.33012,\"unit\":\"g\"},\"FAMS\":{\"label\":\"Monounsaturated\",\"quantity\":2.3598400000000006,\"unit\":\"g\"},\"FAPU\":{\"label\":\"Polyunsaturated\",\"quantity\":0.40124000000000004,\"unit\":\"g\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.37240000000000006,\"unit\":\"g\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"g\"},\"SUGAR\":{\"label\":\"Sugars\",\"quantity\":0.07840000000000001,\"unit\":\"g\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":6.7312,\"unit\":\"g\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":28.560000000000002,\"unit\":\"mg\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":180.32000000000002,\"unit\":\"mg\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":189.00000000000003,\"unit\":\"mg\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":7.5600000000000005,\"unit\":\"mg\"},\"K\":{\"label\":\"Potassium\",\"quantity\":21.28,\"unit\":\"mg\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.044800000000000006,\"unit\":\"mg\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":0.9604000000000001,\"unit\":\"mg\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":132.44000000000003,\"unit\":\"mg\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":73.64,\"unit\":\"µg\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"mg\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.007560000000000001,\"unit\":\"mg\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":0.12152000000000002,\"unit\":\"mg\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.010920000000000001,\"unit\":\"mg\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":0.013720000000000001,\"unit\":\"mg\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLFD\":{\"label\":\"Folate (food)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLAC\":{\"label\":\"Folic acid\",\"quantity\":0,\"unit\":\"µg\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":0.24640000000000004,\"unit\":\"µg\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":0.168,\"unit\":\"µg\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":0.21840000000000004,\"unit\":\"mg\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.812,\"unit\":\"µg\"},\"WATER\":{\"label\":\"Water\",\"quantity\":10.388000000000002,\"unit\":\"g\"}},\"totalDaily\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":5.684,\"unit\":\"%\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":14.568615384615386,\"unit\":\"%\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":27.115200000000005,\"unit\":\"%\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.12413333333333336,\"unit\":\"%\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"%\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":13.4624,\"unit\":\"%\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":9.52,\"unit\":\"%\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":7.5133333333333345,\"unit\":\"%\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":18.900000000000002,\"unit\":\"%\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":1.8,\"unit\":\"%\"},\"K\":{\"label\":\"Potassium\",\"quantity\":0.45276595744680853,\"unit\":\"%\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.2488888888888889,\"unit\":\"%\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":8.730909090909092,\"unit\":\"%\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":18.92,\"unit\":\"%\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":8.182222222222222,\"unit\":\"%\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"%\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.6300000000000001,\"unit\":\"%\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":9.347692307692308,\"unit\":\"%\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.06825,\"unit\":\"%\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":1.0553846153846154,\"unit\":\"%\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":1.8200000000000003,\"unit\":\"%\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":10.26666666666667,\"unit\":\"%\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":1.12,\"unit\":\"%\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":1.4560000000000002,\"unit\":\"%\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.6766666666666666,\"unit\":\"%\"}},\"ingredients\":[{\"parsed\":[{\"quantity\":1,\"measure\":\"whole\",\"food\":\"cheddar cheese\",\"foodId\":\"food_bhppgmha1u27voagb8eptbp9g376\",\"weight\":28,\"retainedWeight\":28,\"servingsPerContainer\":7.071428571428571,\"measureURI\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"status\":\"OK\"}]}]}");
        FoodItemNutrientData nutrientData = model.getFoodItemNutrientData(model.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376"));
        foodItem.setFoodId("food_bhppgmha1u27voagb8eptbp9g376");
        foodItem.setMeasureUri("http://www.edamam.com/ontologies/edamam.owl#Measure_unit");
        foodNutrientDataQuery = new FoodItemNutrientSearchQuery(model, sb, foodItem);
        foodNutrientDataQuery.execute();
        lenient().when(db.fetchSelectedItemNutrientData(foodItem.getFoodId(), foodItem.getFoodLabel())).thenReturn(nutrientData);
        FoodItemNutrientData fd = model.fetchFoodItemNutrientDataBySelection(foodItem.getFoodId(), foodItem.getFoodLabel());

        model.setMaxCalorieAmount(1);
        assertEquals(1, model.getMaxCalorieAmount());
        assertFalse(model.checkFoodItemExceedsMaxCalories());
        model.setNutrientDataOfFoodItem(fd);
        CompareItemEnergyWithMaxCaloriesQuery compareItemEnergyWithMaxCaloriesQuery = new CompareItemEnergyWithMaxCaloriesQuery(model, sb);
        compareItemEnergyWithMaxCaloriesQuery.execute();
        assertTrue(model.checkFoodItemExceedsMaxCalories());

    }

    @Test
    public void testChangingStatusWhenFoodItemsGoAboveAndBelowMaxCalorie() {

        model = new ModelFacadeImpl(foodDummyApi, imgurDummyApi, db, jsonParser, reportParserImpl);
        lenient().when(foodDummyApi.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376")).thenReturn("{\"uri\":\"http://www.edamam" +
                ".com/ontologies/edamam.owl#9f31eef6-10f2-42ce-9c77-d536956be15e\",\"calories\":113,\"totalWeight\":28,\"dietLabels\":[],\"healthLabels\":[\"KETO_FRIENDLY\",\"VEGETARIAN\",\"PESCATARIAN\",\"SPECIFIC_CARBS\",\"GLUTEN_FREE\",\"WHEAT_FREE\",\"EGG_FREE\",\"PEANUT_FREE\",\"TREE_NUT_FREE\",\"SOY_FREE\",\"FISH_FREE\",\"SHELLFISH_FREE\",\"PORK_FREE\",\"RED_MEAT_FREE\",\"CRUSTACEAN_FREE\",\"CELERY_FREE\",\"MUSTARD_FREE\",\"SESAME_FREE\",\"LUPINE_FREE\",\"MOLLUSK_FREE\",\"ALCOHOL_FREE\",\"NO_OIL_ADDED\",\"NO_SUGAR_ADDED\",\"KOSHER\"],\"cautions\":[\"SULFITES\"],\"totalNutrients\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":113.68,\"unit\":\"kcal\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":9.469600000000002,\"unit\":\"g\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":5.42304,\"unit\":\"g\"},\"FATRN\":{\"label\":\"Trans\",\"quantity\":0.33012,\"unit\":\"g\"},\"FAMS\":{\"label\":\"Monounsaturated\",\"quantity\":2.3598400000000006,\"unit\":\"g\"},\"FAPU\":{\"label\":\"Polyunsaturated\",\"quantity\":0.40124000000000004,\"unit\":\"g\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.37240000000000006,\"unit\":\"g\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"g\"},\"SUGAR\":{\"label\":\"Sugars\",\"quantity\":0.07840000000000001,\"unit\":\"g\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":6.7312,\"unit\":\"g\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":28.560000000000002,\"unit\":\"mg\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":180.32000000000002,\"unit\":\"mg\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":189.00000000000003,\"unit\":\"mg\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":7.5600000000000005,\"unit\":\"mg\"},\"K\":{\"label\":\"Potassium\",\"quantity\":21.28,\"unit\":\"mg\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.044800000000000006,\"unit\":\"mg\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":0.9604000000000001,\"unit\":\"mg\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":132.44000000000003,\"unit\":\"mg\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":73.64,\"unit\":\"µg\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"mg\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.007560000000000001,\"unit\":\"mg\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":0.12152000000000002,\"unit\":\"mg\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.010920000000000001,\"unit\":\"mg\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":0.013720000000000001,\"unit\":\"mg\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLFD\":{\"label\":\"Folate (food)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLAC\":{\"label\":\"Folic acid\",\"quantity\":0,\"unit\":\"µg\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":0.24640000000000004,\"unit\":\"µg\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":0.168,\"unit\":\"µg\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":0.21840000000000004,\"unit\":\"mg\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.812,\"unit\":\"µg\"},\"WATER\":{\"label\":\"Water\",\"quantity\":10.388000000000002,\"unit\":\"g\"}},\"totalDaily\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":5.684,\"unit\":\"%\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":14.568615384615386,\"unit\":\"%\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":27.115200000000005,\"unit\":\"%\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.12413333333333336,\"unit\":\"%\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"%\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":13.4624,\"unit\":\"%\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":9.52,\"unit\":\"%\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":7.5133333333333345,\"unit\":\"%\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":18.900000000000002,\"unit\":\"%\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":1.8,\"unit\":\"%\"},\"K\":{\"label\":\"Potassium\",\"quantity\":0.45276595744680853,\"unit\":\"%\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.2488888888888889,\"unit\":\"%\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":8.730909090909092,\"unit\":\"%\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":18.92,\"unit\":\"%\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":8.182222222222222,\"unit\":\"%\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"%\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.6300000000000001,\"unit\":\"%\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":9.347692307692308,\"unit\":\"%\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.06825,\"unit\":\"%\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":1.0553846153846154,\"unit\":\"%\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":1.8200000000000003,\"unit\":\"%\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":10.26666666666667,\"unit\":\"%\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":1.12,\"unit\":\"%\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":1.4560000000000002,\"unit\":\"%\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.6766666666666666,\"unit\":\"%\"}},\"ingredients\":[{\"parsed\":[{\"quantity\":1,\"measure\":\"whole\",\"food\":\"cheddar cheese\",\"foodId\":\"food_bhppgmha1u27voagb8eptbp9g376\",\"weight\":28,\"retainedWeight\":28,\"servingsPerContainer\":7.071428571428571,\"measureURI\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"status\":\"OK\"}]}]}");
        FoodItemNutrientData nutrientData = model.getFoodItemNutrientData(model.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376"));
        foodItem.setFoodId("food_bhppgmha1u27voagb8eptbp9g376");
        foodItem.setMeasureUri("http://www.edamam.com/ontologies/edamam.owl#Measure_unit");
        foodNutrientDataQuery = new FoodItemNutrientSearchQuery(model, sb, foodItem);
        foodNutrientDataQuery.execute();
        lenient().when(db.fetchSelectedItemNutrientData(foodItem.getFoodId(), foodItem.getFoodLabel())).thenReturn(nutrientData);
        FoodItemNutrientData fd = model.fetchFoodItemNutrientDataBySelection(foodItem.getFoodId(), foodItem.getFoodLabel());

        model.setMaxCalorieAmount(900);
        assertEquals(900, model.getMaxCalorieAmount());
        assertFalse(model.checkFoodItemExceedsMaxCalories());
        model.setNutrientDataOfFoodItem(fd);
        compareItemEnergyWithMaxCaloriesQuery = new CompareItemEnergyWithMaxCaloriesQuery(model, sb);
        compareItemEnergyWithMaxCaloriesQuery.execute();
        assertFalse(model.checkFoodItemExceedsMaxCalories());

        lenient().when(foodDummyApi.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376")).thenReturn("{\"uri\":\"http://www.edamam" +
                ".com/ontologies/edamam.owl#9f31eef6-10f2-42ce-9c77-d536956be15e\",\"calories\":901,\"totalWeight\":28,\"dietLabels\":[]," +
                "\"healthLabels\":[\"KETO_FRIENDLY\",\"VEGETARIAN\",\"PESCATARIAN\",\"SPECIFIC_CARBS\",\"GLUTEN_FREE\",\"WHEAT_FREE\",\"EGG_FREE\"," +
                "\"PEANUT_FREE\",\"TREE_NUT_FREE\",\"SOY_FREE\",\"FISH_FREE\",\"SHELLFISH_FREE\",\"PORK_FREE\",\"RED_MEAT_FREE\"," +
                "\"CRUSTACEAN_FREE\",\"CELERY_FREE\",\"MUSTARD_FREE\",\"SESAME_FREE\",\"LUPINE_FREE\",\"MOLLUSK_FREE\",\"ALCOHOL_FREE\"," +
                "\"NO_OIL_ADDED\",\"NO_SUGAR_ADDED\",\"KOSHER\"],\"cautions\":[\"SULFITES\"],\"totalNutrients\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":901,\"unit\":\"kcal\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":9.469600000000002,\"unit\":\"g\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":5.42304,\"unit\":\"g\"},\"FATRN\":{\"label\":\"Trans\",\"quantity\":0.33012,\"unit\":\"g\"},\"FAMS\":{\"label\":\"Monounsaturated\",\"quantity\":2.3598400000000006,\"unit\":\"g\"},\"FAPU\":{\"label\":\"Polyunsaturated\",\"quantity\":0.40124000000000004,\"unit\":\"g\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.37240000000000006,\"unit\":\"g\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"g\"},\"SUGAR\":{\"label\":\"Sugars\",\"quantity\":0.07840000000000001,\"unit\":\"g\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":6.7312,\"unit\":\"g\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":28.560000000000002,\"unit\":\"mg\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":180.32000000000002,\"unit\":\"mg\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":189.00000000000003,\"unit\":\"mg\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":7.5600000000000005,\"unit\":\"mg\"},\"K\":{\"label\":\"Potassium\",\"quantity\":21.28,\"unit\":\"mg\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.044800000000000006,\"unit\":\"mg\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":0.9604000000000001,\"unit\":\"mg\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":132.44000000000003,\"unit\":\"mg\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":73.64,\"unit\":\"µg\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"mg\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.007560000000000001,\"unit\":\"mg\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":0.12152000000000002,\"unit\":\"mg\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.010920000000000001,\"unit\":\"mg\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":0.013720000000000001,\"unit\":\"mg\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLFD\":{\"label\":\"Folate (food)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLAC\":{\"label\":\"Folic acid\",\"quantity\":0,\"unit\":\"µg\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":0.24640000000000004,\"unit\":\"µg\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":0.168,\"unit\":\"µg\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":0.21840000000000004,\"unit\":\"mg\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.812,\"unit\":\"µg\"},\"WATER\":{\"label\":\"Water\",\"quantity\":10.388000000000002,\"unit\":\"g\"}},\"totalDaily\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":5.684,\"unit\":\"%\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":14.568615384615386,\"unit\":\"%\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":27.115200000000005,\"unit\":\"%\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.12413333333333336,\"unit\":\"%\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"%\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":13.4624,\"unit\":\"%\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":9.52,\"unit\":\"%\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":7.5133333333333345,\"unit\":\"%\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":18.900000000000002,\"unit\":\"%\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":1.8,\"unit\":\"%\"},\"K\":{\"label\":\"Potassium\",\"quantity\":0.45276595744680853,\"unit\":\"%\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.2488888888888889,\"unit\":\"%\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":8.730909090909092,\"unit\":\"%\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":18.92,\"unit\":\"%\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":8.182222222222222,\"unit\":\"%\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"%\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.6300000000000001,\"unit\":\"%\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":9.347692307692308,\"unit\":\"%\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.06825,\"unit\":\"%\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":1.0553846153846154,\"unit\":\"%\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":1.8200000000000003,\"unit\":\"%\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":10.26666666666667,\"unit\":\"%\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":1.12,\"unit\":\"%\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":1.4560000000000002,\"unit\":\"%\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.6766666666666666,\"unit\":\"%\"}},\"ingredients\":[{\"parsed\":[{\"quantity\":1,\"measure\":\"whole\",\"food\":\"cheddar cheese\",\"foodId\":\"food_bhppgmha1u27voagb8eptbp9g376\",\"weight\":28,\"retainedWeight\":28,\"servingsPerContainer\":7.071428571428571,\"measureURI\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"status\":\"OK\"}]}]}");
        nutrientData = model.getFoodItemNutrientData(model.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376"));
        foodItem.setFoodId("food_bhppgmha1u27voagb8eptbp9g376");
        foodItem.setMeasureUri("http://www.edamam.com/ontologies/edamam.owl#Measure_unit");
        foodNutrientDataQuery = new FoodItemNutrientSearchQuery(model, sb, foodItem);
        foodNutrientDataQuery.execute();
        lenient().when(db.fetchSelectedItemNutrientData(foodItem.getFoodId(), foodItem.getFoodLabel())).thenReturn(nutrientData);
        fd = model.fetchFoodItemNutrientDataBySelection(foodItem.getFoodId(), foodItem.getFoodLabel());

        assertEquals(900, model.getMaxCalorieAmount());
        assertFalse(model.checkFoodItemExceedsMaxCalories());
        model.setNutrientDataOfFoodItem(fd);
        compareItemEnergyWithMaxCaloriesQuery = new CompareItemEnergyWithMaxCaloriesQuery(model, sb);
        compareItemEnergyWithMaxCaloriesQuery.execute();
        assertTrue(model.checkFoodItemExceedsMaxCalories());


        lenient().when(foodDummyApi.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376")).thenReturn("{\"uri\":\"http://www.edamam" +
                ".com/ontologies/edamam.owl#9f31eef6-10f2-42ce-9c77-d536956be15e\",\"calories\":899,\"totalWeight\":28,\"dietLabels\":[]," +
                "\"healthLabels\":[\"KETO_FRIENDLY\",\"VEGETARIAN\",\"PESCATARIAN\",\"SPECIFIC_CARBS\",\"GLUTEN_FREE\",\"WHEAT_FREE\",\"EGG_FREE\"," +
                "\"PEANUT_FREE\",\"TREE_NUT_FREE\",\"SOY_FREE\",\"FISH_FREE\",\"SHELLFISH_FREE\",\"PORK_FREE\",\"RED_MEAT_FREE\"," +
                "\"CRUSTACEAN_FREE\",\"CELERY_FREE\",\"MUSTARD_FREE\",\"SESAME_FREE\",\"LUPINE_FREE\",\"MOLLUSK_FREE\",\"ALCOHOL_FREE\"," +
                "\"NO_OIL_ADDED\",\"NO_SUGAR_ADDED\",\"KOSHER\"],\"cautions\":[\"SULFITES\"],\"totalNutrients\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":899,\"unit\":\"kcal\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":9.469600000000002,\"unit\":\"g\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":5.42304,\"unit\":\"g\"},\"FATRN\":{\"label\":\"Trans\",\"quantity\":0.33012,\"unit\":\"g\"},\"FAMS\":{\"label\":\"Monounsaturated\",\"quantity\":2.3598400000000006,\"unit\":\"g\"},\"FAPU\":{\"label\":\"Polyunsaturated\",\"quantity\":0.40124000000000004,\"unit\":\"g\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.37240000000000006,\"unit\":\"g\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"g\"},\"SUGAR\":{\"label\":\"Sugars\",\"quantity\":0.07840000000000001,\"unit\":\"g\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":6.7312,\"unit\":\"g\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":28.560000000000002,\"unit\":\"mg\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":180.32000000000002,\"unit\":\"mg\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":189.00000000000003,\"unit\":\"mg\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":7.5600000000000005,\"unit\":\"mg\"},\"K\":{\"label\":\"Potassium\",\"quantity\":21.28,\"unit\":\"mg\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.044800000000000006,\"unit\":\"mg\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":0.9604000000000001,\"unit\":\"mg\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":132.44000000000003,\"unit\":\"mg\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":73.64,\"unit\":\"µg\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"mg\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.007560000000000001,\"unit\":\"mg\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":0.12152000000000002,\"unit\":\"mg\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.010920000000000001,\"unit\":\"mg\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":0.013720000000000001,\"unit\":\"mg\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLFD\":{\"label\":\"Folate (food)\",\"quantity\":7.280000000000001,\"unit\":\"µg\"},\"FOLAC\":{\"label\":\"Folic acid\",\"quantity\":0,\"unit\":\"µg\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":0.24640000000000004,\"unit\":\"µg\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":0.168,\"unit\":\"µg\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":0.21840000000000004,\"unit\":\"mg\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.812,\"unit\":\"µg\"},\"WATER\":{\"label\":\"Water\",\"quantity\":10.388000000000002,\"unit\":\"g\"}},\"totalDaily\":{\"ENERC_KCAL\":{\"label\":\"Energy\",\"quantity\":5.684,\"unit\":\"%\"},\"FAT\":{\"label\":\"Fat\",\"quantity\":14.568615384615386,\"unit\":\"%\"},\"FASAT\":{\"label\":\"Saturated\",\"quantity\":27.115200000000005,\"unit\":\"%\"},\"CHOCDF\":{\"label\":\"Carbs\",\"quantity\":0.12413333333333336,\"unit\":\"%\"},\"FIBTG\":{\"label\":\"Fiber\",\"quantity\":0,\"unit\":\"%\"},\"PROCNT\":{\"label\":\"Protein\",\"quantity\":13.4624,\"unit\":\"%\"},\"CHOLE\":{\"label\":\"Cholesterol\",\"quantity\":9.52,\"unit\":\"%\"},\"NA\":{\"label\":\"Sodium\",\"quantity\":7.5133333333333345,\"unit\":\"%\"},\"CA\":{\"label\":\"Calcium\",\"quantity\":18.900000000000002,\"unit\":\"%\"},\"MG\":{\"label\":\"Magnesium\",\"quantity\":1.8,\"unit\":\"%\"},\"K\":{\"label\":\"Potassium\",\"quantity\":0.45276595744680853,\"unit\":\"%\"},\"FE\":{\"label\":\"Iron\",\"quantity\":0.2488888888888889,\"unit\":\"%\"},\"ZN\":{\"label\":\"Zinc\",\"quantity\":8.730909090909092,\"unit\":\"%\"},\"P\":{\"label\":\"Phosphorus\",\"quantity\":18.92,\"unit\":\"%\"},\"VITA_RAE\":{\"label\":\"Vitamin A\",\"quantity\":8.182222222222222,\"unit\":\"%\"},\"VITC\":{\"label\":\"Vitamin C\",\"quantity\":0,\"unit\":\"%\"},\"THIA\":{\"label\":\"Thiamin (B1)\",\"quantity\":0.6300000000000001,\"unit\":\"%\"},\"RIBF\":{\"label\":\"Riboflavin (B2)\",\"quantity\":9.347692307692308,\"unit\":\"%\"},\"NIA\":{\"label\":\"Niacin (B3)\",\"quantity\":0.06825,\"unit\":\"%\"},\"VITB6A\":{\"label\":\"Vitamin B6\",\"quantity\":1.0553846153846154,\"unit\":\"%\"},\"FOLDFE\":{\"label\":\"Folate equivalent (total)\",\"quantity\":1.8200000000000003,\"unit\":\"%\"},\"VITB12\":{\"label\":\"Vitamin B12\",\"quantity\":10.26666666666667,\"unit\":\"%\"},\"VITD\":{\"label\":\"Vitamin D\",\"quantity\":1.12,\"unit\":\"%\"},\"TOCPHA\":{\"label\":\"Vitamin E\",\"quantity\":1.4560000000000002,\"unit\":\"%\"},\"VITK1\":{\"label\":\"Vitamin K\",\"quantity\":0.6766666666666666,\"unit\":\"%\"}},\"ingredients\":[{\"parsed\":[{\"quantity\":1,\"measure\":\"whole\",\"food\":\"cheddar cheese\",\"foodId\":\"food_bhppgmha1u27voagb8eptbp9g376\",\"weight\":28,\"retainedWeight\":28,\"servingsPerContainer\":7.071428571428571,\"measureURI\":\"http://www.edamam.com/ontologies/edamam.owl#Measure_unit\",\"status\":\"OK\"}]}]}");
        nutrientData = model.getFoodItemNutrientData(model.foodNutritionSearchRequest("http://www.edamam.com/ontologies/edamam.owl#Measure_unit", "food_bhppgmha1u27voagb8eptbp9g376"));
        foodItem.setFoodId("food_bhppgmha1u27voagb8eptbp9g376");
        foodItem.setMeasureUri("http://www.edamam.com/ontologies/edamam.owl#Measure_unit");
        foodNutrientDataQuery = new FoodItemNutrientSearchQuery(model, sb, foodItem);
        foodNutrientDataQuery.execute();
        lenient().when(db.fetchSelectedItemNutrientData(foodItem.getFoodId(), foodItem.getFoodLabel())).thenReturn(nutrientData);
        fd = model.fetchFoodItemNutrientDataBySelection(foodItem.getFoodId(), foodItem.getFoodLabel());

        assertEquals(900, model.getMaxCalorieAmount());
        assertTrue(model.checkFoodItemExceedsMaxCalories());
        model.setNutrientDataOfFoodItem(fd);
        compareItemEnergyWithMaxCaloriesQuery = new CompareItemEnergyWithMaxCaloriesQuery(model, sb);
        compareItemEnergyWithMaxCaloriesQuery.execute();
        assertFalse(model.checkFoodItemExceedsMaxCalories());

    }


}
